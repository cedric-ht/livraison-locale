<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Dashboard Commer√ßant</title>
  <style>
    body {font-family: Arial, sans-serif; max-width: 600px; margin:auto; padding:2rem;}
    h2 {color:#0077b6;}
    ul {list-style:none; padding:0;}
    li {margin:0.5rem 0; display:flex; justify-content:space-between; align-items:center;}
    button {padding:0.3rem 0.6rem; cursor:pointer;}
    .available {background:#2d6a4f; color:white; border:none;}
    .unavailable {background:#d00000; color:white; border:none;}
  </style>
</head>
<body>

<h2>Mes produits</h2>
<ul id="productList"></ul>

<button onclick="logout()" style="margin-top:2rem;">Se d√©connecter</button>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
  import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-auth.js";
  import { getFirestore, collection, doc, getDocs, updateDoc } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";

  // üîë REMPLACE avec TES vraies valeurs Firebase
  const firebaseConfig = {
    apiKey: "AIzaSyB1mljASb5TevqJ1ucDqgXsYQZqEnNxQts",
    authDomain: "livraison-sablaise.firebaseapp.com",
    projectId: "livraison-sablaise",
    storageBucket: "livraison-sablaise.firebasestorage.app",
    messagingSenderId: "930839535214",
    appId: "1:930839535214:web:a3235919aa88d066bc507f",
    measurementId: "G-R3ZCGLQ69E"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  // V√©rifie si l'utilisateur est connect√©
  onAuthStateChanged(auth, async user => {
    if (!user) {
      window.location.href = "login.html"; // redirection si non connect√©
      return;
    }

    const productList = document.getElementById("productList");
    productList.innerHTML = "";

    // R√©f√©rence aux produits du commerce connect√©
    const productsRef = collection(db, "commerces", user.uid, "produits");
    const snapshot = await getDocs(productsRef);

    snapshot.forEach(docSnap => {
      const product = docSnap.data();
      const li = document.createElement("li");
      li.innerHTML = `
        <span>${product.name} - ${product.price}‚Ç¨</span>
        <button class="${product.available ? 'available' : 'unavailable'}">${product.available ? 'Disponible' : 'Indisponible'}</button>
      `;
      const btn = li.querySelector("button");
      btn.onclick = async () => {
        const newStatus = !product.available;
        await updateDoc(doc(db, "commerces", user.uid, "produits", docSnap.id), {available: newStatus});
        btn.innerText = newStatus ? "Disponible" : "Indisponible";
        btn.className = newStatus ? "available" : "unavailable";
        product.available = newStatus; // mise √† jour locale
      };
      productList.appendChild(li);
    });
  });

  function logout() {
    signOut(auth).then(() => window.location.href = "login.html");
  }
</script>

</body>
</html>
